<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Samlytics CV Optimizer - ATS-Optimized Resume Builder</title>
    <meta name="description" content="Get personalized CV sections optimized for 90-100% ATS compatibility. AI-powered professional summary, skills, and achievements tailored to your target job.">
    <meta name="keywords" content="CV optimizer, ATS resume, resume builder, job application, career tools, Samlytics">
    
    <!-- Favicon -->
    <link rel="icon" href="./samlytics-logo.png" type="image/png">
    <link rel="apple-touch-icon" href="./samlytics-logo.png">
    
    <!-- Open Graph -->
    <meta property="og:title" content="Samlytics CV Optimizer">
    <meta property="og:description" content="AI-powered CV optimization for maximum ATS compatibility">
    <meta property="og:image" content="./samlytics-logo.png">
    <meta property="og:url" content="https://samlytics.co.uk">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        slate: {
                            50: '#f8fafc',
                            100: '#f1f5f9',
                            200: '#e2e8f0',
                            300: '#cbd5e1',
                            400: '#94a3b8',
                            500: '#64748b',
                            600: '#475569',
                            700: '#334155',
                            800: '#1e293b',
                            900: '#0f172a'
                        }
                    }
                }
            }
        }
    </script>
    
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
    
    <style>
        .gradient-bg {
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 50%, #0f172a 100%);
        }
        .radial-gradient {
            background: radial-gradient(circle at 50% 50%, rgba(59, 130, 246, 0.1), transparent 50%);
        }
        .card-bg {
            background: rgba(30, 41, 59, 0.9);
            backdrop-filter: blur(8px);
        }
        .btn-primary {
            background: linear-gradient(to right, #2563eb, #84cc16);
        }
        .btn-primary:hover {
            background: linear-gradient(to right, #1d4ed8, #65a30d);
        }
        .hidden { display: none; }
        .animate-spin {
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        .progress-bar {
            background: linear-gradient(to right, #3b82f6, #84cc16);
            transition: width 0.3s ease;
        }
    </style>
</head>
<body class="min-h-screen gradient-bg text-white">
    <!-- API Key Setup Modal -->
    <div id="apiKeyModal" class="fixed inset-0 z-50 flex items-center justify-center">
        <div class="absolute inset-0 radial-gradient"></div>
        
        <!-- Navigation -->
        <div class="absolute top-0 left-0 right-0 z-10 container mx-auto px-4 py-6">
            <div class="flex items-center justify-between">
                <div class="flex items-center gap-3">
                    <img src="./samlytics-logo.png" alt="Samlytics Logo" class="w-8 h-8 rounded-lg">
                    <span class="text-white font-semibold">Samlytics</span>
                    <span class="text-blue-400">CV Optimizer</span>
                </div>
                <button onclick="window.open('https://samlytics.co.uk', '_blank')" 
                        class="border border-slate-600 text-slate-300 hover:bg-slate-800 bg-transparent px-4 py-2 rounded-md flex items-center gap-2">
                    <i data-lucide="arrow-left" class="w-4 h-4"></i>
                    Back to Samlytics
                </button>
            </div>
        </div>

        <div class="relative z-10 w-full max-w-4xl mx-4 max-h-[90vh] overflow-y-auto">
            <div class="card-bg border border-slate-700 rounded-lg p-8">
                <div class="text-center pb-8">
                    <div class="w-16 h-16 bg-gradient-to-br from-blue-600 to-blue-700 rounded-2xl flex items-center justify-center mx-auto mb-4">
                        <i data-lucide="key" class="w-8 h-8 text-white"></i>
                    </div>
                    <h1 class="text-2xl font-bold text-white mb-2">AI Provider Setup</h1>
                    <p class="text-slate-300 text-lg">Choose your preferred AI provider for CV optimization</p>
                </div>

                <div class="space-y-8">
                    <!-- Provider Selection -->
                    <div class="space-y-4">
                        <label class="text-white font-medium block">Select AI Provider</label>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <!-- Free Providers -->
                            <div class="space-y-3">
                                <h3 class="text-lime-400 font-semibold text-sm uppercase tracking-wide">Free Providers</h3>
                                
                                <label class="flex items-center p-4 bg-slate-700/50 border border-slate-600 rounded-lg cursor-pointer hover:bg-slate-700/70 transition-colors">
                                    <input type="radio" name="provider" value="groq" class="mr-3" checked>
                                    <div class="flex-1">
                                        <div class="font-medium text-white">Groq</div>
                                        <div class="text-sm text-slate-300">Fast inference, free tier available</div>
                                    </div>
                                </label>

                                <label class="flex items-center p-4 bg-slate-700/50 border border-slate-600 rounded-lg cursor-pointer hover:bg-slate-700/70 transition-colors">
                                    <input type="radio" name="provider" value="huggingface" class="mr-3">
                                    <div class="flex-1">
                                        <div class="font-medium text-white">Hugging Face</div>
                                        <div class="text-sm text-slate-300">Free inference API, multiple models</div>
                                    </div>
                                </label>

                                <label class="flex items-center p-4 bg-slate-700/50 border border-slate-600 rounded-lg cursor-pointer hover:bg-slate-700/70 transition-colors">
                                    <input type="radio" name="provider" value="gemini-free" class="mr-3">
                                    <div class="flex-1">
                                        <div class="font-medium text-white">Gemini 1.5 Flash (Free)</div>
                                        <div class="text-sm text-slate-300">Google's free tier</div>
                                    </div>
                                </label>

                                <label class="flex items-center p-4 bg-slate-700/50 border border-slate-600 rounded-lg cursor-pointer hover:bg-slate-700/70 transition-colors">
                                    <input type="radio" name="provider" value="openrouter" class="mr-3">
                                    <div class="flex-1">
                                        <div class="font-medium text-white">OpenRouter</div>
                                        <div class="text-sm text-slate-300">Access to multiple models, free credits</div>
                                    </div>
                                </label>
                            </div>

                            <!-- Paid Providers -->
                            <div class="space-y-3">
                                <h3 class="text-yellow-400 font-semibold text-sm uppercase tracking-wide">Premium Providers</h3>
                                
                                <label class="flex items-center p-4 bg-slate-700/50 border border-slate-600 rounded-lg cursor-pointer hover:bg-slate-700/70 transition-colors">
                                    <input type="radio" name="provider" value="openai" class="mr-3">
                                    <div class="flex-1">
                                        <div class="font-medium text-white">OpenAI</div>
                                        <div class="text-sm text-slate-300">GPT-4, GPT-3.5 Turbo</div>
                                    </div>
                                </label>

                                <label class="flex items-center p-4 bg-slate-700/50 border border-slate-600 rounded-lg cursor-pointer hover:bg-slate-700/70 transition-colors">
                                    <input type="radio" name="provider" value="gemini-pro" class="mr-3">
                                    <div class="flex-1">
                                        <div class="font-medium text-white">Gemini Pro</div>
                                        <div class="text-sm text-slate-300">Google's premium models</div>
                                    </div>
                                </label>

                                <label class="flex items-center p-4 bg-slate-700/50 border border-slate-600 rounded-lg cursor-pointer hover:bg-slate-700/70 transition-colors">
                                    <input type="radio" name="provider" value="azure" class="mr-3">
                                    <div class="flex-1">
                                        <div class="font-medium text-white">Azure OpenAI</div>
                                        <div class="text-sm text-slate-300">Microsoft Azure AI services</div>
                                    </div>
                                </label>

                                <label class="flex items-center p-4 bg-slate-700/50 border border-slate-600 rounded-lg cursor-pointer hover:bg-slate-700/70 transition-colors">
                                    <input type="radio" name="provider" value="deepseek" class="mr-3">
                                    <div class="flex-1">
                                        <div class="font-medium text-white">DeepSeek</div>
                                        <div class="text-sm text-slate-300">Advanced reasoning models</div>
                                    </div>
                                </label>
                            </div>
                        </div>
                    </div>

                    <!-- Dynamic Configuration Forms -->
                    <div id="providerConfig" class="space-y-6">
                        <!-- Configuration will be populated based on selection -->
                    </div>

                    <!-- Setup Instructions -->
                    <div id="setupInstructions" class="bg-slate-700/50 p-6 rounded-xl border border-slate-600">
                        <!-- Instructions will be populated based on selection -->
                    </div>

                    <!-- Form -->
                    <form id="apiKeyForm" class="space-y-4">
                        <button 
                            type="submit" 
                            id="validateBtn"
                            class="w-full bg-gradient-to-r from-blue-600 to-blue-700 hover:from-blue-700 hover:to-blue-800 text-white font-semibold h-12 text-base rounded-md"
                        >
                            Validate & Continue
                        </button>
                        <div id="validation-error" class="text-red-400 text-sm hidden"></div>
                    </form>

                    <div class="bg-slate-700/30 border border-slate-600 rounded-lg p-4">
                        <p class="text-xs text-slate-300">
                            <strong>Privacy Note:</strong> Your API credentials are stored locally in your browser and used solely to make requests to your chosen AI provider. No data is sent to any other servers.
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Application -->
    <div id="mainApp" class="hidden min-h-screen">
        <!-- Navigation -->
        <div class="container mx-auto px-4 py-6">
            <div class="flex items-center justify-between">
                <div class="flex items-center gap-3">
                    <img src="./samlytics-logo.png" alt="Samlytics Logo" class="w-8 h-8 rounded-lg">
                    <span class="text-white font-semibold">Samlytics</span>
                    <span class="text-blue-400">CV Optimizer</span>
                </div>
                <div class="flex items-center gap-4">
                    <div class="flex items-center gap-2">
                        <i data-lucide="check-circle" class="w-5 h-5 text-lime-400"></i>
                        <span class="text-sm text-lime-400">API Connected</span>
                    </div>
                    <button onclick="showApiKeySetup()" class="border border-slate-600 text-slate-300 hover:bg-slate-800 px-3 py-1 rounded-md text-sm">
                        Change API Key
                    </button>
                    <button onclick="window.open('https://samlytics.co.uk', '_blank')" 
                            class="border border-slate-600 text-slate-300 hover:bg-slate-800 bg-transparent px-4 py-2 rounded-md flex items-center gap-2">
                        <i data-lucide="arrow-left" class="w-4 h-4"></i>
                        Back to Samlytics
                    </button>
                </div>
            </div>
        </div>

        <div class="container mx-auto px-4 py-8">
            <!-- Hero Section -->
            <div class="text-center mb-8">
                <h1 class="text-5xl font-bold mb-4">
                    <span class="text-white">ATS </span>
                    <span class="text-blue-400">CV</span>
                    <span class="text-lime-400"> Optimizer</span>
                </h1>
                <p class="text-xl text-slate-300 max-w-3xl mx-auto mb-6">
                    Get personalized CV sections optimized for 90-100% ATS compatibility. Receive targeted improvements for your summary, skills, and achievements.
                </p>
            </div>

            <!-- Feature Cards -->
            <div class="grid lg:grid-cols-3 gap-8 mb-8">
                <div class="bg-slate-800 border border-slate-700 rounded-lg p-6">
                    <div class="text-center">
                        <i data-lucide="user" class="w-12 h-12 mx-auto text-blue-400 mb-2"></i>
                        <h3 class="text-white font-semibold mb-2">Professional Summary</h3>
                        <p class="text-slate-300 text-sm">AI-crafted summary tailored to job requirements</p>
                    </div>
                </div>
                <div class="bg-slate-800 border border-slate-700 rounded-lg p-6">
                    <div class="text-center">
                        <i data-lucide="briefcase" class="w-12 h-12 mx-auto text-lime-400 mb-2"></i>
                        <h3 class="text-white font-semibold mb-2">Core Skills</h3>
                        <p class="text-slate-300 text-sm">Essential skills matching job posting keywords</p>
                    </div>
                </div>
                <div class="bg-slate-800 border border-slate-700 rounded-lg p-6">
                    <div class="text-center">
                        <i data-lucide="award" class="w-12 h-12 mx-auto text-yellow-400 mb-2"></i>
                        <h3 class="text-white font-semibold mb-2">Achievements</h3>
                        <p class="text-slate-300 text-sm">Quantified accomplishments with impact metrics</p>
                    </div>
                </div>
            </div>

            <!-- Main Form -->
            <div class="max-w-4xl mx-auto bg-slate-800 border border-slate-700 rounded-lg p-8">
                <div class="mb-6">
                    <h2 class="text-white text-xl font-semibold flex items-center gap-2 mb-2">
                        <i data-lucide="target" class="w-6 h-6 text-blue-400"></i>
                        ATS Optimization Tool
                    </h2>
                    <p class="text-slate-300">Upload your CV and job description to get section-specific optimizations for maximum ATS compatibility</p>
                </div>

                <form id="optimizeForm" class="space-y-6">
                    <!-- CV Upload -->
                    <div class="space-y-2">
                        <label for="cv-upload" class="text-white block">Upload Your CV *</label>
                        <input 
                            id="cv-upload" 
                            type="file" 
                            accept=".pdf,.doc,.docx,.txt" 
                            class="w-full bg-slate-700 border border-slate-600 text-white rounded-md p-3 file:bg-blue-600 file:text-white file:border-0 file:rounded-md file:px-4 file:py-2 file:mr-4"
                            required
                        >
                        <div id="file-status" class="text-sm hidden"></div>
                        <p class="text-xs text-slate-400">Note: For best results, please use plain text (.txt) files</p>
                    </div>

                    <!-- Experience Summary -->
                    <div class="space-y-2">
                        <label for="experience" class="text-white block">Experience Summary *</label>
                        <textarea 
                            id="experience" 
                            placeholder="Briefly describe your professional background, key skills, and career highlights..."
                            rows="4"
                            class="w-full bg-slate-700 border border-slate-600 text-white placeholder:text-slate-400 rounded-md p-3"
                            required
                        ></textarea>
                    </div>

                    <!-- Job Description Tabs -->
                    <div class="space-y-4">
                        <div class="flex bg-slate-700 rounded-lg p-1">
                            <button type="button" id="urlTab" onclick="switchTab('url')" class="flex-1 py-2 px-4 rounded-md bg-blue-600 text-white">Job URL</button>
                            <button type="button" id="descTab" onclick="switchTab('description')" class="flex-1 py-2 px-4 rounded-md text-slate-300">Job Description</button>
                        </div>

                        <!-- URL Tab -->
                        <div id="urlTabContent" class="space-y-4">
                            <div class="space-y-2">
                                <label for="job-url" class="text-white block">Job Posting URL</label>
                                <div class="flex gap-2">
                                    <input 
                                        id="job-url" 
                                        type="url" 
                                        placeholder="https://example.com/job-posting"
                                        class="flex-1 bg-slate-700 border border-slate-600 text-white placeholder:text-slate-400 rounded-md p-3"
                                    >
                                    <button type="button" onclick="openJobUrl()" class="border border-slate-600 text-slate-300 hover:bg-slate-700 px-4 py-2 rounded-md flex items-center gap-2">
                                        <i data-lucide="external-link" class="w-4 h-4"></i>
                                        Open Job URL
                                    </button>
                                </div>
                            </div>

                            <div id="urlInstructions" class="bg-slate-700 border border-slate-600 rounded-lg p-4 hidden">
                                <div class="flex items-start gap-3">
                                    <i data-lucide="alert-circle" class="w-4 h-4 text-blue-400 mt-0.5"></i>
                                    <div class="text-slate-200">
                                        <p class="font-medium">Manual Copy Required:</p>
                                        <p class="text-sm mt-1">Since this is a static site, you need to manually copy the job description from the opened page and paste it in the "Job Description" tab.</p>
                                        <button type="button" onclick="copyInstructions()" class="mt-2 border border-slate-600 text-slate-300 hover:bg-slate-700 px-3 py-1 rounded-md text-sm flex items-center gap-2">
                                            <i data-lucide="copy" class="w-3 h-3"></i>
                                            Copy Instructions
                                        </button>
                                    </div>
                                </div>
                            </div>

                            <div class="bg-slate-700 border border-slate-600 rounded-lg p-4">
                                <div class="flex items-start gap-3">
                                    <i data-lucide="alert-circle" class="w-4 h-4 text-blue-400 mt-0.5"></i>
                                    <p class="text-slate-200">
                                        <strong>GitHub Pages Limitation:</strong> Direct URL fetching is not available due to CORS restrictions. Use the "Open Job URL" button to visit the job posting, then manually copy and paste the job description in the "Job Description" tab.
                                    </p>
                                </div>
                            </div>
                        </div>

                        <!-- Description Tab -->
                        <div id="descTabContent" class="space-y-2 hidden">
                            <label for="job-desc" class="text-white block">Job Description *</label>
                            <textarea 
                                id="job-desc" 
                                placeholder="Paste the full job description here..."
                                rows="6"
                                class="w-full bg-slate-700 border border-slate-600 text-white placeholder:text-slate-400 rounded-md p-3"
                                required
                            ></textarea>
                            <p class="text-sm text-slate-400">Copy and paste the complete job description. If you have a job URL, use the "Job URL" tab to open it first.</p>
                        </div>
                    </div>

                    <!-- Submit Button -->
                    <button 
                        type="submit" 
                        id="analyzeBtn"
                        class="w-full btn-primary text-white font-semibold py-4 rounded-md text-lg"
                    >
                        Get ATS-Optimized Sections
                    </button>
                </form>
            </div>
        </div>
    </div>

    <!-- Loading Modal -->
    <div id="loadingModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center hidden">
        <div class="bg-slate-800 border border-slate-700 rounded-lg p-8 text-center">
            <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-blue-400 mx-auto mb-4"></div>
            <p class="text-white">Analyzing & Optimizing...</p>
        </div>
    </div>

    <script>
        // Initialize Lucide icons
        lucide.createIcons();

        // Global variables
        let apiKey = '';
        let currentTab = 'url';

        // Check for stored API key on load
        window.addEventListener('load', function() {
            const storedKey = localStorage.getItem('groq_api_key');
            if (storedKey) {
                apiKey = storedKey;
                showMainApp();
            }
        });

        // Provider configurations
        const providerConfigs = {
            groq: {
                name: 'Groq',
                fields: [
                    { name: 'apiKey', label: 'Groq API Key', type: 'password', placeholder: 'gsk_...', required: true }
                ],
                models: ['llama3-70b-8192', 'llama3-8b-8192', 'mixtral-8x7b-32768'],
                instructions: [
                    'Visit <a href="https://console.groq.com" target="_blank" class="text-blue-400 hover:text-blue-300 underline">console.groq.com</a>',
                    'Sign up for a free account or log in',
                    'Navigate to the API Keys section',
                    'Create a new API key',
                    'Copy the API key and paste it below'
                ]
            },
            huggingface: {
                name: 'Hugging Face',
                fields: [
                    { name: 'apiKey', label: 'HF API Token', type: 'password', placeholder: 'hf_...', required: true },
                    { name: 'model', label: 'Model', type: 'select', options: [
                        'microsoft/DialoGPT-large',
                        'microsoft/DialoGPT-medium',
                        'facebook/blenderbot-400M-distill',
                        'google/flan-t5-large'
                    ], required: true }
                ],
                instructions: [
                    'Visit <a href="https://huggingface.co/settings/tokens" target="_blank" class="text-blue-400 hover:text-blue-300 underline">huggingface.co/settings/tokens</a>',
                    'Create a new token with "Read" permissions',
                    'Copy the token and select your preferred model'
                ]
            },
            'gemini-free': {
                name: 'Gemini 1.5 Flash (Free)',
                fields: [
                    { name: 'apiKey', label: 'Google AI API Key', type: 'password', placeholder: 'AIza...', required: true }
                ],
                models: ['gemini-1.5-flash', 'gemini-1.5-flash-8b'],
                instructions: [
                    'Visit <a href="https://aistudio.google.com/app/apikey" target="_blank" class="text-blue-400 hover:text-blue-300 underline">Google AI Studio</a>',
                    'Create a new API key',
                    'Copy the API key (free tier includes generous limits)'
                ]
            },
            openrouter: {
                name: 'OpenRouter',
                fields: [
                    { name: 'apiKey', label: 'OpenRouter API Key', type: 'password', placeholder: 'sk-or-...', required: true },
                    { name: 'model', label: 'Model', type: 'select', options: [
                        'meta-llama/llama-3.1-8b-instruct:free',
                        'microsoft/phi-3-mini-128k-instruct:free',
                        'google/gemma-2-9b-it:free',
                        'qwen/qwen-2-7b-instruct:free'
                    ], required: true }
                ],
                instructions: [
                    'Visit <a href="https://openrouter.ai/keys" target="_blank" class="text-blue-400 hover:text-blue-300 underline">openrouter.ai/keys</a>',
                    'Create an account and generate an API key',
                    'Select a free model or add credits for premium models'
                ]
            },
            openai: {
                name: 'OpenAI',
                fields: [
                    { name: 'apiKey', label: 'OpenAI API Key', type: 'password', placeholder: 'sk-...', required: true },
                    { name: 'model', label: 'Model', type: 'select', options: [
                        'gpt-4o',
                        'gpt-4o-mini',
                        'gpt-4-turbo',
                        'gpt-3.5-turbo'
                    ], required: true }
                ],
                instructions: [
                    'Visit <a href="https://platform.openai.com/api-keys" target="_blank" class="text-blue-400 hover:text-blue-300 underline">OpenAI API Keys</a>',
                    'Create a new secret key',
                    'Add billing information to your account',
                    'Copy the API key and select your model'
                ]
            },
            'gemini-pro': {
                name: 'Gemini Pro',
                fields: [
                    { name: 'apiKey', label: 'Google AI API Key', type: 'password', placeholder: 'AIza...', required: true },
                    { name: 'model', label: 'Model', type: 'select', options: [
                        'gemini-2.0-flash-exp',
                        'gemini-1.5-pro',
                        'gemini-1.5-pro-002'
                    ], required: true }
                ],
                instructions: [
                    'Visit <a href="https://aistudio.google.com/app/apikey" target="_blank" class="text-blue-400 hover:text-blue-300 underline">Google AI Studio</a>',
                    'Create a new API key',
                    'Enable billing for access to Pro models',
                    'Copy the API key and select your model'
                ]
            },
            azure: {
                name: 'Azure OpenAI',
                fields: [
                    { name: 'apiKey', label: 'Azure API Key', type: 'password', placeholder: 'your-key', required: true },
                    { name: 'endpoint', label: 'Azure Endpoint', type: 'url', placeholder: 'https://your-resource.openai.azure.com/', required: true },
                    { name: 'deployment', label: 'Deployment Name', type: 'text', placeholder: 'gpt-4', required: true },
                    { name: 'apiVersion', label: 'API Version', type: 'text', placeholder: '2024-02-15-preview', value: '2024-02-15-preview', required: true }
                ],
                instructions: [
                    'Create an Azure OpenAI resource in the Azure portal',
                    'Deploy a model (GPT-4, GPT-3.5, etc.)',
                    'Get your API key and endpoint from the resource',
                    'Enter your deployment name and API version'
                ]
            },
            deepseek: {
                name: 'DeepSeek',
                fields: [
                    { name: 'apiKey', label: 'DeepSeek API Key', type: 'password', placeholder: 'sk-...', required: true },
                    { name: 'model', label: 'Model', type: 'select', options: [
                        'deepseek-chat',
                        'deepseek-coder'
                    ], required: true }
                ],
                instructions: [
                    'Visit <a href="https://platform.deepseek.com/api_keys" target="_blank" class="text-blue-400 hover:text-blue-300 underline">DeepSeek Platform</a>',
                    'Create an account and generate an API key',
                    'Add credits to your account for usage',
                    'Copy the API key and select your model'
                ]
            }
        };

        // Update provider configuration display
        function updateProviderConfig() {
            const selectedProvider = document.querySelector('input[name="provider"]:checked').value;
            const config = providerConfigs[selectedProvider];
            
            // Update configuration form
            const configDiv = document.getElementById('providerConfig');
            configDiv.innerHTML = `
                <h3 class="text-lg font-semibold text-white flex items-center gap-2">
                    <span class="w-6 h-6 bg-blue-600 rounded-full flex items-center justify-center text-sm text-white">2</span>
                    Configure ${config.name}
                </h3>
                ${config.fields.map(field => {
                    if (field.type === 'select') {
                        return `
                            <div class="space-y-2">
                                <label for="${field.name}" class="text-white font-medium block">${field.label}</label>
                                <select id="${field.name}" name="${field.name}" class="w-full bg-slate-700/70 border border-slate-600 text-white rounded-md p-3" ${field.required ? 'required' : ''}>
                                    ${field.options.map(option => `<option value="${option}">${option}</option>`).join('')}
                                </select>
                            </div>
                        `;
                    } else {
                        return `
                            <div class="space-y-2">
                                <label for="${field.name}" class="text-white font-medium block">${field.label}</label>
                                <input 
                                    id="${field.name}" 
                                    name="${field.name}"
                                    type="${field.type}" 
                                    placeholder="${field.placeholder || ''}"
                                    value="${field.value || ''}"
                                    class="w-full bg-slate-700/70 border border-slate-600 text-white placeholder:text-slate-400 rounded-md p-3"
                                    ${field.required ? 'required' : ''}
                                >
                            </div>
                        `;
                    }
                }).join('')}
            `;

            // Update instructions
            const instructionsDiv = document.getElementById('setupInstructions');
            instructionsDiv.innerHTML = `
                <h3 class="text-lg font-semibold mb-4 text-white flex items-center gap-2">
                    <span class="w-6 h-6 bg-blue-600 rounded-full flex items-center justify-center text-sm text-white">1</span>
                    How to get your ${config.name} credentials:
                </h3>
                <ol class="list-decimal list-inside space-y-3 text-sm text-slate-300 ml-8">
                    ${config.instructions.map(instruction => `<li>${instruction}</li>`).join('')}
                </ol>
            `;
        }

        // Add event listeners for provider selection
        document.addEventListener('DOMContentLoaded', function() {
            const providerRadios = document.querySelectorAll('input[name="provider"]');
            providerRadios.forEach(radio => {
                radio.addEventListener('change', updateProviderConfig);
            });
            
            // Initialize with default selection
            updateProviderConfig();
        });

        // Update API validation function
        async function validateApiCredentials(provider, credentials) {
            try {
                switch (provider) {
                    case 'groq':
                        return await validateGroq(credentials.apiKey);
                    case 'huggingface':
                        return await validateHuggingFace(credentials.apiKey, credentials.model);
                    case 'gemini-free':
                    case 'gemini-pro':
                        return await validateGemini(credentials.apiKey, credentials.model || 'gemini-1.5-flash');
                    case 'openrouter':
                        return await validateOpenRouter(credentials.apiKey, credentials.model);
                    case 'openai':
                        return await validateOpenAI(credentials.apiKey, credentials.model);
                    case 'azure':
                        return await validateAzure(credentials);
                    case 'deepseek':
                        return await validateDeepSeek(credentials.apiKey, credentials.model);
                    default:
                        throw new Error('Unsupported provider');
                }
            } catch (error) {
                throw error;
            }
        }

        // Provider-specific validation functions
        async function validateGroq(apiKey) {
            const response = await fetch('https://api.groq.com/openai/v1/chat/completions', {
                method: 'POST',
                headers: {
                    'Authorization': `Bearer ${apiKey}`,
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    model: 'llama3-70b-8192',
                    messages: [{ role: 'user', content: 'Hello' }],
                    max_tokens: 5,
                }),
            });
            
            if (!response.ok) {
                const error = await response.json();
                throw new Error(error.error?.message || 'Groq API validation failed');
            }
            return true;
        }

        async function validateOpenAI(apiKey, model) {
            const response = await fetch('https://api.openai.com/v1/chat/completions', {
                method: 'POST',
                headers: {
                    'Authorization': `Bearer ${apiKey}`,
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    model: model,
                    messages: [{ role: 'user', content: 'Hello' }],
                    max_tokens: 5,
                }),
            });
            
            if (!response.ok) {
                const error = await response.json();
                throw new Error(error.error?.message || 'OpenAI API validation failed');
            }
            return true;
        }

        async function validateGemini(apiKey, model) {
            const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/${model}:generateContent?key=${apiKey}`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    contents: [{
                        parts: [{ text: 'Hello' }]
                    }],
                    generationConfig: {
                        maxOutputTokens: 5
                    }
                }),
            });
            
            if (!response.ok) {
                const error = await response.json();
                throw new Error(error.error?.message || 'Gemini API validation failed');
            }
            return true;
        }

        async function validateOpenRouter(apiKey, model) {
            const response = await fetch('https://openrouter.ai/api/v1/chat/completions', {
                method: 'POST',
                headers: {
                    'Authorization': `Bearer ${apiKey}`,
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    model: model,
                    messages: [{ role: 'user', content: 'Hello' }],
                    max_tokens: 5,
                }),
            });
            
            if (!response.ok) {
                const error = await response.json();
                throw new Error(error.error?.message || 'OpenRouter API validation failed');
            }
            return true;
        }

        async function validateHuggingFace(apiKey, model) {
            const response = await fetch(`https://api-inference.huggingface.co/models/${model}`, {
                method: 'POST',
                headers: {
                    'Authorization': `Bearer ${apiKey}`,
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    inputs: 'Hello',
                    parameters: { max_length: 5 }
                }),
            });
            
            if (!response.ok) {
                const error = await response.json();
                throw new Error(error.error || 'Hugging Face API validation failed');
            }
            return true;
        }

        async function validateAzure(credentials) {
            const { apiKey, endpoint, deployment, apiVersion } = credentials;
            const url = `${endpoint}openai/deployments/${deployment}/chat/completions?api-version=${apiVersion}`;
            
            const response = await fetch(url, {
                method: 'POST',
                headers: {
                    'api-key': apiKey,
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    messages: [{ role: 'user', content: 'Hello' }],
                    max_tokens: 5,
                }),
            });
            
            if (!response.ok) {
                const error = await response.json();
                throw new Error(error.error?.message || 'Azure OpenAI API validation failed');
            }
            return true;
        }

        async function validateDeepSeek(apiKey, model) {
            const response = await fetch('https://api.deepseek.com/v1/chat/completions', {
                method: 'POST',
                headers: {
                    'Authorization': `Bearer ${apiKey}`,
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    model: model,
                    messages: [{ role: 'user', content: 'Hello' }],
                    max_tokens: 5,
                }),
            });
            
            if (!response.ok) {
                const error = await response.json();
                throw new Error(error.error?.message || 'DeepSeek API validation failed');
            }
            return true;
        }

        // Update the API Key form submission
        document.getElementById('apiKeyForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const validateBtn = document.getElementById('validateBtn');
            const errorDiv = document.getElementById('validation-error');
            const selectedProvider = document.querySelector('input[name="provider"]:checked').value;
            
            // Collect form data
            const formData = new FormData(e.target);
            const credentials = {};
            
            // Get all form fields
            const configDiv = document.getElementById('providerConfig');
            const inputs = configDiv.querySelectorAll('input, select');
            inputs.forEach(input => {
                credentials[input.name] = input.value.trim();
            });

            // Validate required fields
            const config = providerConfigs[selectedProvider];
            const missingFields = config.fields.filter(field => 
                field.required && !credentials[field.name]
            );
            
            if (missingFields.length > 0) {
                showError(`Please fill in: ${missingFields.map(f => f.label).join(', ')}`);
                return;
            }

            validateBtn.innerHTML = '<div class="animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2 inline-block"></div>Validating...';
            validateBtn.disabled = true;
            errorDiv.classList.add('hidden');

            try {
                await validateApiCredentials(selectedProvider, credentials);
                
                // Store configuration
                const providerData = {
                    provider: selectedProvider,
                    credentials: credentials,
                    config: config
                };
                
                localStorage.setItem('ai_provider_config', JSON.stringify(providerData));
                showMainApp();
            } catch (error) {
                showError(`Validation failed: ${error.message}`);
            } finally {
                validateBtn.innerHTML = 'Validate & Continue';
                validateBtn.disabled = false;
            }
        });

        function showError(message) {
            const errorDiv = document.getElementById('validation-error');
            errorDiv.textContent = message;
            errorDiv.classList.remove('hidden');
        }

        function showMainApp() {
            document.getElementById('apiKeyModal').classList.add('hidden');
            document.getElementById('mainApp').classList.remove('hidden');
        }

        function showApiKeySetup() {
            document.getElementById('mainApp').classList.add('hidden');
            document.getElementById('apiKeyModal').classList.remove('hidden');
        }

        // Tab switching
        function switchTab(tab) {
            currentTab = tab;
            const urlTab = document.getElementById('urlTab');
            const descTab = document.getElementById('descTab');
            const urlContent = document.getElementById('urlTabContent');
            const descContent = document.getElementById('descTabContent');

            if (tab === 'url') {
                urlTab.classList.add('bg-blue-600', 'text-white');
                urlTab.classList.remove('text-slate-300');
                descTab.classList.remove('bg-blue-600', 'text-white');
                descTab.classList.add('text-slate-300');
                urlContent.classList.remove('hidden');
                descContent.classList.add('hidden');
            } else {
                descTab.classList.add('bg-blue-600', 'text-white');
                descTab.classList.remove('text-slate-300');
                urlTab.classList.remove('bg-blue-600', 'text-white');
                urlTab.classList.add('text-slate-300');
                descContent.classList.remove('hidden');
                urlContent.classList.add('hidden');
            }
        }

        // File upload handling
        document.getElementById('cv-upload').addEventListener('change', function(e) {
            const file = e.target.files[0];
            const statusDiv = document.getElementById('file-status');
            
            if (file) {
                statusDiv.innerHTML = `<div class="text-lime-400 flex items-center gap-1"><i data-lucide="check-circle" class="w-4 h-4"></i>${file.name} uploaded successfully</div>`;
                statusDiv.classList.remove('hidden');
                lucide.createIcons();
            }
        });

        // Job URL handling
        function openJobUrl() {
            const jobUrl = document.getElementById('job-url').value;
            if (jobUrl) {
                window.open(jobUrl, '_blank');
                document.getElementById('urlInstructions').classList.remove('hidden');
            }
        }

        function copyInstructions() {
            const instructions = `How to extract job description from the URL:

1. Click "Open Job URL" to visit the job posting
2. On the job posting page, select all the job description text
3. Copy the text (Ctrl+C or Cmd+C)
4. Come back to this tab
5. Paste the job description in the "Job Description" tab below

This workaround is needed because GitHub Pages cannot directly fetch content from external websites due to CORS restrictions.`;
            
            navigator.clipboard.writeText(instructions).then(() => {
                alert('Instructions copied to clipboard!');
            });
        }

        // Update the analysis function to support multiple providers
        async function makeAIRequest(prompt, maxTokens = 1800) {
            const providerData = JSON.parse(localStorage.getItem('ai_provider_config'));
            if (!providerData) {
                throw new Error('No AI provider configured');
            }

            const { provider, credentials } = providerData;

            switch (provider) {
                case 'groq':
                    return await makeGroqRequest(credentials.apiKey, prompt, maxTokens);
                case 'openai':
                    return await makeOpenAIRequest(credentials.apiKey, credentials.model, prompt, maxTokens);
                case 'gemini-free':
                case 'gemini-pro':
                    return await makeGeminiRequest(credentials.apiKey, credentials.model || 'gemini-1.5-flash', prompt, maxTokens);
                case 'openrouter':
                    return await makeOpenRouterRequest(credentials.apiKey, credentials.model, prompt, maxTokens);
                case 'huggingface':
                    return await makeHuggingFaceRequest(credentials.apiKey, credentials.model, prompt, maxTokens);
                case 'azure':
                    return await makeAzureRequest(credentials, prompt, maxTokens);
                case 'deepseek':
                    return await makeDeepSeekRequest(credentials.apiKey, credentials.model, prompt, maxTokens);
                default:
                    throw new Error('Unsupported provider');
            }
        }

        // Provider-specific request functions
        async function makeGroqRequest(apiKey, prompt, maxTokens) {
            const response = await fetch('https://api.groq.com/openai/v1/chat/completions', {
                method: 'POST',
                headers: {
                    'Authorization': `Bearer ${apiKey}`,
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    model: 'llama3-70b-8192',
                    messages: [{ role: 'user', content: prompt }],
                    max_tokens: maxTokens,
                    temperature: 0.7,
                }),
            });

            if (!response.ok) {
                const error = await response.json();
                throw new Error(error.error?.message || 'API request failed');
            }

            const data = await response.json();
            return data.choices[0]?.message?.content || '';
        }

        async function makeOpenAIRequest(apiKey, model, prompt, maxTokens) {
            const response = await fetch('https://api.openai.com/v1/chat/completions', {
                method: 'POST',
                headers: {
                    'Authorization': `Bearer ${apiKey}`,
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    model: model,
                    messages: [{ role: 'user', content: prompt }],
                    max_tokens: maxTokens,
                    temperature: 0.7,
                }),
            });

            if (!response.ok) {
                const error = await response.json();
                throw new Error(error.error?.message || 'OpenAI API request failed');
            }

            const data = await response.json();
            return data.choices[0]?.message?.content || '';
        }

        async function makeGeminiRequest(apiKey, model, prompt, maxTokens) {
            const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/${model}:generateContent?key=${apiKey}`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    contents: [{
                        parts: [{ text: prompt }]
                    }],
                    generationConfig: {
                        maxOutputTokens: maxTokens,
                        temperature: 0.7
                    }
                }),
            });

            if (!response.ok) {
                const error = await response.json();
                throw new Error(error.error?.message || 'Gemini API request failed');
            }

            const data = await response.json();
            return data.candidates[0]?.content?.parts[0]?.text || '';
        }

        async function makeOpenRouterRequest(apiKey, model, prompt, maxTokens) {
            const response = await fetch('https://openrouter.ai/api/v1/chat/completions', {
                method: 'POST',
                headers: {
                    'Authorization': `Bearer ${apiKey}`,
                    'Content-Type': 'application/json',
                    'HTTP-Referer': window.location.origin,
                    'X-Title': 'Samlytics CV Optimizer'
                },
                body: JSON.stringify({
                    model: model,
                    messages: [{ role: 'user', content: prompt }],
                    max_tokens: maxTokens,
                    temperature: 0.7,
                }),
            });

            if (!response.ok) {
                const error = await response.json();
                throw new Error(error.error?.message || 'OpenRouter API request failed');
            }

            const data = await response.json();
            return data.choices[0]?.message?.content || '';
        }

        async function makeHuggingFaceRequest(apiKey, model, prompt, maxTokens) {
            const response = await fetch(`https://api-inference.huggingface.co/models/${model}`, {
                method: 'POST',
                headers: {
                    'Authorization': `Bearer ${apiKey}`,
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    inputs: prompt,
                    parameters: {
                        max_new_tokens: maxTokens,
                        temperature: 0.7,
                        return_full_text: false
                    }
                }),
            });

            if (!response.ok) {
                const error = await response.json();
                throw new Error(error.error || 'Hugging Face API request failed');
            }

            const data = await response.json();
            return Array.isArray(data) ? data[0]?.generated_text || '' : data.generated_text || '';
        }

        async function makeAzureRequest(credentials, prompt, maxTokens) {
            const { apiKey, endpoint, deployment, apiVersion } = credentials;
            const url = `${endpoint}openai/deployments/${deployment}/chat/completions?api-version=${apiVersion}`;
            
            const response = await fetch(url, {
                method: 'POST',
                headers: {
                    'api-key': apiKey,
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    messages: [{ role: 'user', content: prompt }],
                    max_tokens: maxTokens,
                    temperature: 0.7,
                }),
            });

            if (!response.ok) {
                const error = await response.json();
                throw new Error(error.error?.message || 'Azure OpenAI API request failed');
            }

            const data = await response.json();
            return data.choices[0]?.message?.content || '';
        }

        async function makeDeepSeekRequest(apiKey, model, prompt, maxTokens) {
            const response = await fetch('https://api.deepseek.com/v1/chat/completions', {
                method: 'POST',
                headers: {
                    'Authorization': `Bearer ${apiKey}`,
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    model: model,
                    messages: [{ role: 'user', content: prompt }],
                    max_tokens: maxTokens,
                    temperature: 0.7,
                }),
            });

            if (!response.ok) {
                const error = await response.json();
                throw new Error(error.error?.message || 'DeepSeek API request failed');
            }

            const data = await response.json();
            return data.choices[0]?.message?.content || '';
        }

        // Update the form submission to use the new AI request function
        document.getElementById('optimizeForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const cvFile = document.getElementById('cv-upload').files[0];
            const experience = document.getElementById('experience').value;
            const jobDesc = document.getElementById('job-desc').value;
            
            if (!cvFile || !experience || !jobDesc) {
                alert('Please fill in all required fields. Note: You need to paste the job description manually.');
                return;
            }

            document.getElementById('loadingModal').classList.remove('hidden');

            try {
                // Read CV file
                const cvText = await readFileAsText(cvFile);
                
                // Create analysis prompt (same as before)
                const prompt = `You are an expert ATS optimization specialist. Analyze the candidate's CV against the job description and provide targeted improvements to achieve 90-100% ATS compatibility.

Return STRICT JSON matching exactly this shape (no markdown, no extras):

{
  "atsScore": <current score 0-100>,
  "targetScore": <projected score after improvements 90-100>,
  "optimizedSummary": "<2-3 sentence professional summary optimized for this role>",
  "coreSkills": ["skill1", "skill2", "skill3", "skill4", "skill5"],
  "personalizedAchievements": [
    {
      "role": "Job Title",
      "achievement": "Quantified achievement statement with metrics",
      "keywords": ["keyword1", "keyword2"]
    }
  ],
  "missingKeywords": ["critical keyword1", "critical keyword2"],
  "atsImprovements": [
    "Specific improvement 1",
    "Specific improvement 2"
  ],
  "keywordDensity": {
    "important_skill": 2.5,
    "another_skill": 1.8
  }
}

Focus on:
1. Professional summary that mirrors job requirements
2. 5 core skills that match job posting exactly
3. 3-5 achievement statements with quantified results
4. Critical missing keywords for ATS scanning
5. Specific improvements to reach 90%+ ATS score

--- INPUTS ---

Current CV:
${cvText.slice(0, 6000)}

Experience Summary:
${experience.slice(0, 1000)}

Target Job Description:
${jobDesc.slice(0, 3000)}`;

                // Make AI request using the configured provider
                const response = await makeAIRequest(prompt, 1800);
                const result = safeJsonParse(response);

                // Store result and redirect
                sessionStorage.setItem('analysisResult', JSON.stringify(result));
                window.location.href = './results.html';
                
            } catch (error) {
                console.error('Error:', error);
                alert(`Analysis failed: ${error.message}`);
            } finally {
                document.getElementById('loadingModal').classList.add('hidden');
            }
        });

        // Update the initial load check
        window.addEventListener('load', function() {
            const providerConfig = localStorage.getItem('ai_provider_config');
            if (providerConfig) {
                const config = JSON.parse(providerConfig);
                showMainApp();
                
                // Update the connected status
                const connectedDiv = document.querySelector('.text-lime-400');
                if (connectedDiv) {
                    connectedDiv.textContent = `${config.config.name} Connected`;
                }
            }
        });

        // Helper functions
        function readFileAsText(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = (e) => resolve(e.target.result);
                reader.onerror = (e) => reject(e);
                reader.readAsText(file);
            });
        }

        function safeJsonParse(raw) {
            // Remove Markdown fences
            let src = raw.replace(/\`\`\`(?:json)?/gi, '').trim();
            const first = src.indexOf('{');
            const last = src.lastIndexOf('}');
            if (first === -1 || last === -1 || last <= first) {
                throw new Error('No JSON object found');
            }
            src = src.slice(first, last + 1);

            // Escape newlines in strings
            let out = '';
            let inString = false;
            let prev = '';
            for (let i = 0; i < src.length; i++) {
                const ch = src[i];
                if (ch === '"' && prev !== '\\') {
                    inString = !inString;
                }
                if (inString && (ch === '\n' || ch === '\r')) {
                    out += '\\n';
                } else {
                    out += ch;
                }
                prev = ch;
            }

            return JSON.parse(out);
        }
    </script>
</body>
</html>
